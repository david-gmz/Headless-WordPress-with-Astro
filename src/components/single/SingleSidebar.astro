---
import Button from "../ui/Button.astro";

interface Props {
    author: {
        name: string;
        bio: string;
        avatar: {
            src: string;
            alt: string;
        };
    };
    tableOfContent: {
        heading: string;
        anchor: string;
    }[];
    category: string[];
    countryData:
        | null
        | {
              name: {
                  nativeName: {
                      spa: {
                          common: string;
                      };
                  };
              };
              capital: string;
              flags: {
                  svg: string;
              };
              population: number;
              area: number;
              maps: {
                  googleMaps: string;
              };
          }[];
}

const { author, tableOfContent, category, countryData } = Astro.props;
---

<div class="lg:space-y-8">
    <!-- Country Data -->
    {
        countryData && (
            <div class="bg-card rounded-lg p-6">
                <img
                    src={countryData[0].flags.svg}
                    alt={countryData[0].name.nativeName.spa.common}
                    class="w-24 h-16 mb-4"
                />
                <h3 class="font-medium mb-4">
                    {countryData[0].name.nativeName.spa.common}
                </h3>

                <p class="text-sm text-muted-foreground">
                    <strong>Población:</strong>
                    {countryData[0].population}
                </p>
                <p class="text-sm text-muted-foreground">
                    <strong>Area:</strong>
                    {countryData[0].area} km²
                </p>
                <p class="text-sm text-muted-foreground">
                    <strong>Capital:</strong>
                    {countryData[0].capital}
                </p>
                <Button
                    variant="secondary"
                    href={countryData[0].maps.googleMaps}
                    class="w-full mt-4">
                    Ver en Google Maps
                </Button>
            </div>
        )
    }
    <!-- Author -->
    <div class="bg-card rounded-lg p-6">
        <div class="flex items-center gap-4 mb-4">
            <img
                src={author.avatar.src}
                alt={author.avatar.alt ?? author.name}
                class="w-12 h-12 rounded-full"
            />
            <div>
                <h3 class="font-medium">{author.name}</h3>
                <p class="text-sm text-muted-foreground">{author.bio}</p>
            </div>
        </div>
        <Button variant="secondary" class="w-full">Seguir</Button>
    </div>

    <!-- Table of Content -->
    {
        tableOfContent && tableOfContent.length > 0 && (
            <div class="bg-card rounded-lg p-6">
                <h3 class="font-medium mb-4">Contenido</h3>
                {category && <p class="text-sm text-muted-foreground mb-3">
                    {category.length > 1 ? "Categorías: " : "categoría: "} {category.map(cat => `#${cat} `)}
                </p>}
                <nav>
                    <ul class="space-y-2">
                        {tableOfContent.map(({ heading, anchor }) => (
                            <li>
                                <a
                                    href={`#${anchor}`}
                                    class="text-sm text-muted-foreground hover:text-foreground transition-colors scroll-smooth"
                                    data-anchor={anchor}>
                                    {heading}
                                </a>
                            </li>
                        ))}
                    </ul>
                </nav>
            </div>
        )
    }
</div>
<script>
    // Ensure smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (this: HTMLAnchorElement, e) {
            e.preventDefault();
            const target = document.querySelector(
                this.getAttribute("href") || ""
            );
            if (target) {
                target.scrollIntoView({ behavior: "smooth" });
            }
        });
    });
    // Add scroll margin to all headings
    const scrollMargin = "scroll-mt-24"; // Adjust this value
    const headings = document.querySelectorAll("h1, h2, h3, h4, h5, h6");
    headings.forEach(heading => {
        if (heading instanceof HTMLElement) {
            heading.classList.add(scrollMargin);
        }
    });
</script>
