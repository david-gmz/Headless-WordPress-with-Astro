---
import Layout from "@layouts/Layout.astro";
import { wpQuery } from "@lib/wpQuery";
import type { PaginateFn, WPPost } from "@lib/wpQuery";
import { Image } from "astro:assets";
import type { Page } from "astro";
import PostCard from "@components/PostCard.astro";

export const prerender = true;
export async function getStaticPaths({
    paginate
}: {
    paginate: PaginateFn<WPPost>;
}) {
    const data = await wpQuery({
        query: `
        query AllPosts {
          posts(where: {orderby: {field: DATE, order: DESC}}) {
            nodes {
              slug
              date
              title
              excerpt
              featuredImage {
                node {
                  sourceUrl,
                  altText
                }
              }
            }
          }
        }
        `
    });
    const posts = data.posts.nodes;

    return paginate(posts, { pageSize: 6 });
}
const { page } = Astro.props as { page: Page<WPPost> };

const posts = page.data;
---

<Layout>
    <div class="bg-slate-200 rounded-lg py-12">
        <h1 class="text-center text-3xl">Our Articles</h1>
    </div>

    <div class="flex flex-wrap pt-5 -mx-2.5">
        {
            posts.map((post: WPPost) => (
                <PostCard post={post} />
            ))
        }
    </div>

    <div class="flex gap-6 justify-center items-center py-12">
        {
            page.url.prev && (
                <a
                    class="p-3 rounded-md bg-slate-500 text-white"
                    href={page.url.prev}>
                    Previous
                </a>
            )
        }
        {
            page.url.next && (
                <a
                    class="p-3 rounded-md bg-slate-500 text-white"
                    href={page.url.next}>
                    Next
                </a>
            )
        }
    </div>
</Layout>
